{"version":3,"sources":["createTranslator.jsx"],"names":["createTranslator","dictinary","options","parent","dic","localized","sprintf","vsprintf","sprintfjs","moment","getLocale","locale","setLocale","loc","getCurrency","currency","setCurrency","getMoment","lookUp","word","entry","w","t","texts","length","arr","tlen","plen","ln","i","push","join","f","params","Array","isArray","raw","slice","tf","fmt","args","_t","_f","translator","v","arguments","derive","dict"],"mappings":"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","file":"createTranslator.js","sourcesContent":["// MIT license (see LICENSE)\n// Copyright 2019 @rigidrabbit\nimport moment from 'moment'\nimport sprintfjs from 'localized-sprintf-js'\n\nexport default function createTranslator(dictinary, options, parent) {\n  const dic = dictinary || {}\n  let localized = null\n  let sprintf\n  let vsprintf\n  if (parent) {\n    sprintf = parent.sprintf\n    vsprintf = parent.vsprintf\n  } else {\n    options = options || {}\n    localized = sprintfjs.localized({ ...options, moment })\n    sprintf = localized.sprintf\n    vsprintf = localized.vsprintf\n  }\n\n  function getLocale() {\n    if (parent) {\n      return parent.locale\n    }\n    return localized.locale()\n  }\n\n  function setLocale(loc) {\n    if (parent) {\n      parent.locale(loc)\n      return\n    }\n    localized.locale(loc)\n  }\n\n  function getCurrency() {\n    if (parent) {\n      return parent.currency\n    }\n    return localized.currency()\n  }\n\n  function setCurrency(loc) {\n    if (parent) {\n      parent.currency(loc)\n      return\n    }\n    localized.currency(loc)\n  }\n\n  function getMoment() {\n    return moment\n  }\n\n  function lookUp(word) {\n    const entry = dic[word]\n    if (entry) {\n      let w = entry[getLocale()]\n      if (typeof w === 'string') {\n        return w\n      }\n      w = entry['*']\n      if (typeof w === 'string') {\n        return w\n      }\n    }\n    if (parent) {\n      return parent.lookUp(word)\n    }\n    return word\n  }\n\n  function t(texts, ...params) {\n    if (typeof texts === 'string') {\n      return lookUp(texts)\n    }\n    if (texts.length === 1 && params.length === 0) {\n      return lookUp(texts[0])\n    }\n    // console.error('params is not empty!', texts, params, raws)\n    const arr = []\n    const tlen = texts.length\n    const plen = params.length\n    const ln = tlen > plen ? tlen : plen\n    for (let i = 0; i < ln; i++) {\n      if (i < tlen) {\n        arr.push(texts[i])\n      }\n      if (i < plen) {\n        arr.push(params[i])\n      }\n    }\n    return lookUp(arr.join(''))\n  }\n\n  function f(texts, ...params) {\n    if (typeof texts === 'string') {\n      return vsprintf(lookUp(texts), ...params)\n    }\n    if (Array.isArray(texts) && texts.raw == null && texts.length && typeof texts[0] === 'string') {\n      return vsprintf(lookUp(texts[0]), texts.slice(1))\n    }\n    return function tf(...args) {\n      const fmt = t(texts, ...params)\n      return vsprintf(fmt, args)\n    }\n  }\n\n  /* eslint-disable no-underscore-dangle */\n  function _t(texts, ...params) {\n    if (texts && Array.isArray(texts.raw)) {\n      return t(texts.raw, ...params)\n    }\n    return t(texts, ...params)\n  }\n\n  function _f(texts, ...params) {\n    if (texts && Array.isArray(texts.raw)) {\n      texts.raw.raw = []\n      return f(texts.raw, ...params)\n    }\n    return f(texts, ...params)\n  }\n\n  /* eslint-enable no-underscore-dangle */\n\n  const translator = {\n    t,\n    f,\n    _t,\n    _f,\n    sprintf,\n    vsprintf,\n    lookUp,\n    locale(v) {\n      if (arguments.length === 0 || (arguments.length === 1 && v === void 0)) {\n        return getLocale()\n      }\n      setLocale(v)\n      return getLocale()\n    },\n    currency(v) {\n      if (arguments.length === 0 || (arguments.length === 1 && v === void 0)) {\n        return getCurrency()\n      }\n      setCurrency(v)\n      return getCurrency()\n    },\n    moment() {\n      return getMoment()\n    },\n    derive(dict) {\n      return createTranslator(dict, null, translator)\n    },\n  }\n\n  return translator\n}\n"]}